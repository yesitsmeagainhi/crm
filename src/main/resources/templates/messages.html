<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
	<th:block layout:replace="fragments/htmlhead"></th:block>
	<style>
	        /* Additional styles for modern design */
			.message-text {
			  vertical-align: top !important;
			  text-align: left !important;
			  white-space: normal !important;
			  word-break: break-word;
			}
	        body {
	            background-color: #f8f9fa;
	            font-family: 'Roboto', sans-serif;
	        }

	        .main-content {
	            margin-left: 250px; /* Adjust based on sidebar width */
	            padding: 20px;
	        }

	        h1 {
	            font-size: 1.75rem;
	            font-weight: bold;
	            color: #333;
	        }

	        .card {
	            border: none;
	            border-radius: 10px;
	            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
	        }

	        .card-header {
	            background-color: #007bff;
	            color: white;
	            border-radius: 10px 10px 0 0;
	            padding: 15px;
	        }

	        .card-header h6 {
	            margin: 0;
	            font-size: 1.2rem;
	        }

	        .table {
	            width: 100%;
	            margin-bottom: 1rem;
	            color: #212529;
	            border-collapse: collapse;
	        }

	        .table th, .table td {
	            padding: 0.4rem;
	            text-align: left;
	            vertical-align: middle;
	            border-top: 1px solid #dee2e6;
	        }

	        .table thead th {
	            background-color: #f1f3f5;
	            color: #495057;
	            font-size: 0.85rem;
	            text-transform: uppercase;
	        }

	        .btn {
	            font-size: 0.875rem;
	            border-radius: 5px;
	            transition: background-color 0.3s, color 0.3s;
	        }

	        .btn-edit {
	            background-color: #ffc107;
	            color: white;
	        }

	        .btn-save {
	            background-color: #28a745;
	            color: white;
	        }

	        .btn-cancel, .btn-delete {
	            background-color: #dc3545;
	            color: white;
	        }

	        .btn-add {
	            background-color: #007bff;
	            color: white;
	            margin-bottom: 15px;
	        }

	        .btn:hover {
	            opacity: 0.85;
	        }

	        .pagination {
	            display: flex;
	            justify-content: center;
	            margin-top: 20px;
	        }

	        .pagination a {
	            display: inline-block;
	            padding: 10px 15px;
	            margin: 0 5px;
	            border: 1px solid #ddd;
	            border-radius: 5px;
	            background-color: #ffffff;
	            color: #133b5c;
	            text-decoration: none;
	            font-size: 0.9rem;
	            transition: all 0.3s;
	        }

	        .pagination a.active {
	            background-color: #133b5c;
	            color: white;
	            border-color: #133b5c;
	            pointer-events: none;
	        }

	        .pagination a:hover {
	            background-color: #f1f3f5;
	            color: #133b5c;
	        }

	        @media (max-width: 768px) {
	            table {
	                width: 100%;
	                display: block;
	                overflow-x: auto;
	                white-space: nowrap;
	            }
	            .pagination {
	                flex-wrap: wrap;
	            }
	        }

	        /* Modal styles */
	        .modal {
	            display: none;
	            position: fixed;
	            z-index: 1050;
	            left: 0;
	            top: 0;
	            width: 100%;
	            height: 100%;
	            overflow: hidden;
	            background-color: rgba(0, 0, 0, 0.5);
	            justify-content: center;
	            align-items: center;
	        }

	        .modal-content {
	            background-color: #fff;
	            border-radius: 10px;
	            padding: 20px;
	            width: 90%;
	            max-width: 500px;
	            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
	            text-align: center;
	        }

	        .modal-header {
	            margin-bottom: 15px;
	        }

	        .modal-header h5 {
	            margin: 0;
	            font-size: 1.25rem;
	        }

	        .close {
	            position: absolute;
	            right: 15px;
	            top: 15px;
	            font-size: 1.5rem;
	            cursor: pointer;
	            color: #000;
	        }

	    </style>
<body>
    <!-- Include sidebar -->
	<th:block layout:replace="fragments/sidebar"></th:block>
	<th:block th:if="${access != null and !#lists.isEmpty(access)}"
      th:with="
        messageMasterAccess=${#lists.isEmpty(access.?[modules.name == 'MESSAGE MASTER']) ? null : access.?[modules.name == 'MESSAGE MASTER'][0]}
      ">
    <main class="main-content">
        <div class="container-fluid py-4">
			<div class="d-flex justify-content-between">
				<h1>Message Master Data</h1>
				<button th:if="${messageMasterAccess != null and (messageMasterAccess.isEdit == true)}" class="btn bg-gradient-primary float-right m-2 btn-add-msg" onclick="openModal()"><i class="material-icons opacity-10">add</i></button>
			</div>
            
            <div class="card">
                
                <div class="card-body px-0 pt-0 pb-2">
					

                    <!-- Modal for Add Message -->
                    <div id="addMessageModal" class="modal">
                        <div class="modal-content">
                            <span class="close" onclick="closeModal()">&times;</span>
                            <div class="modal-header d-flex justify-content-center">
                                <h5>Add New Message</h5>
                            </div>
                            <div class="form-group">
                                <label for="newMessageName">Message Name</label>
                                <input type="text" id="newMessageName" class="form-control" placeholder="Enter message name">
                            </div>
                            <div class="form-group">
                                <label for="newMessageText">Message Text</label>
                                <input type="text" id="newMessageText" class="form-control" placeholder="Enter message text">
                            </div>
                            <button class="btn btn-primary" onclick="addMessage()">Save</button>
                            <button class="btn btn-cancel" onclick="closeModal()">Cancel</button>
                        </div>
                    </div>
                    <table class="table align-items-center mb-0">
                        <thead>
                            <tr>
                                <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Message ID</th>
                                <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Message Name</th>
                                <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Message Text</th>
                                <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7" th:if="${messageMasterAccess != null and (messageMasterAccess.isEdit == true)}">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="message : ${messages}" th:attr="data-id=${message.id}">
                                <td th:text="${message.id}"></td>
                                <td>
                                    <span th:text="${message.messageName}" class="name-display"></span>
                                    <input type="text" class="name-input form-control" th:value="${message.messageName}" style="display: none;">
                                </td>
                                <td class="message-text">
                                    <span th:text="${message.text}" class="text-display"></span>
                                    <textarea type="text" class="text-input form-control" th:text="${message.text}" style="display: none;">
                                    </textarea>
                                </td>
                                <td th:if="${messageMasterAccess != null and (messageMasterAccess.isEdit == true)}">
                                    <button class="btn btn-sm bg-gradient-primary btn-edit" onclick="editMessage(this)">Edit</button>
                                    <button class="btn btn-sm bg-gradient-primary btn-save" onclick="saveMessage(this)" style="display: none;">Save</button>
                                    <button class="btn btn-sm btn-danger btn-cancel" onclick="cancelEdit(this)" style="display: none;">Cancel</button>
                                    <button class="btn btn-sm btn-danger btn-delete" th:onclick="'deleteMessage(' + ${message.id} + ')'">Delete</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="pagination mt-3">
                        <a th:href="@{/messages?page=1}" th:classappend="${currentPage == 1} ? ' active' : ''">First</a>
                        <a th:href="@{/messages?page={page}(page=${currentPage - 1})}" th:if="${currentPage > 1}">Previous</a>
                        <span th:each="page : ${#numbers.sequence(1, totalPages)}">
                            <a th:href="@{/messages?page={page}(page=${page})}" 
                               th:classappend="${page == currentPage} ? ' active' : ''" 
                               th:text="${page}"></a>
                        </span>
                        <a th:href="@{/messages?page={page}(page=${currentPage + 1})}" th:if="${currentPage < totalPages}">Next</a>
                        <a th:href="@{/messages?page={page}(page=${totalPages})}" th:classappend="${currentPage == totalPages} ? ' active' : ''">Last</a>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
		// Open the Add Message Modal
		function openModal() {
		    const modal = document.getElementById('addMessageModal');
		    modal.style.display = 'flex'; // Show the modal as a flexbox
		}

		// Close the Add Message Modal
		function closeModal() {
		    const modal = document.getElementById('addMessageModal');
		    modal.style.display = 'none'; // Hide the modal
		}

		// Add a new message
		function addMessage() {
		    const messageName = document.getElementById('newMessageName').value.trim();
		    const messageText = document.getElementById('newMessageText').value.trim();

		    if (!messageName || !messageText) {
		        alert('Please fill in both fields.');
		        return;
		    }

		    // Send data to the backend
		    fetch('/messages/add', {
		        method: 'POST',
		        headers: {
		            'Content-Type': 'application/x-www-form-urlencoded',
		        },
		        body: `messageName=${encodeURIComponent(messageName)}&text=${encodeURIComponent(messageText)}`,
		    })
		        .then((response) => {
		            if (response.ok) {
		                location.reload(); // Reload the page after adding the message
		            } else {
		                alert('Failed to add the message.');
		            }
		        })
		        .catch((error) => console.error('Error:', error));
		}

		// Edit an existing message
		function editMessage(button) {
		    const row = button.closest('tr');
		    const nameDisplay = row.querySelector('.name-display');
		    const nameInput = row.querySelector('.name-input');
		    const textDisplay = row.querySelector('.text-display');
		    const textInput = row.querySelector('.text-input');
		    const saveButton = row.querySelector('.btn-save');
		    const cancelButton = row.querySelector('.btn-cancel');

		    nameDisplay.style.display = 'none';
		    nameInput.style.display = 'block';
		    textDisplay.style.display = 'none';
		    textInput.style.display = 'block';
		    button.style.display = 'none';
		    saveButton.style.display = 'inline-block';
		    cancelButton.style.display = 'inline-block';
		}

		// Save edited message
		function saveMessage(button) {
		    const row = button.closest('tr');
		    const nameDisplay = row.querySelector('.name-display');
		    const nameInput = row.querySelector('.name-input');
		    const textDisplay = row.querySelector('.text-display');
		    const textInput = row.querySelector('.text-input');
		    const editButton = row.querySelector('.btn-edit');
		    const cancelButton = row.querySelector('.btn-cancel');
		    const messageId = row.getAttribute('data-id');

		    const updatedName = nameInput.value.trim();
		    const updatedText = textInput.value.trim();

		    if (!updatedName || !updatedText) {
		        alert('Please fill in both fields.');
		        return;
		    }

		    // Send updated data to the backend
		    fetch('/messages/update', {
		        method: 'POST',
		        headers: {
		            'Content-Type': 'application/x-www-form-urlencoded',
		        },
		        body: `id=${messageId}&messageName=${encodeURIComponent(updatedName)}&text=${encodeURIComponent(updatedText)}`,
		    })
		        .then((response) => {
		            if (response.ok) {
		                nameDisplay.textContent = updatedName;
		                textDisplay.textContent = updatedText;

		                nameDisplay.style.display = 'block';
		                nameInput.style.display = 'none';
		                textDisplay.style.display = 'block';
		                textInput.style.display = 'none';
		                button.style.display = 'none';
		                cancelButton.style.display = 'none';
		                editButton.style.display = 'inline-block';
		            } else {
		                alert('Failed to save the message.');
		            }
		        })
		        .catch((error) => console.error('Error:', error));
		}

		// Cancel editing a message
		function cancelEdit(button) {
		    const row = button.closest('tr');
		    const nameDisplay = row.querySelector('.name-display');
		    const nameInput = row.querySelector('.name-input');
		    const textDisplay = row.querySelector('.text-display');
		    const textInput = row.querySelector('.text-input');
		    const editButton = row.querySelector('.btn-edit');
		    const saveButton = row.querySelector('.btn-save');

		    nameInput.style.display = 'none';
		    nameDisplay.style.display = 'block';
		    textInput.style.display = 'none';
		    textDisplay.style.display = 'block';
		    button.style.display = 'none';
		    saveButton.style.display = 'none';
		    editButton.style.display = 'inline-block';
		}

		// Delete a message
		function deleteMessage(messageId) {
		    if (confirm('Are you sure you want to delete this message?')) {
		        fetch(`/messages/delete/${messageId}`, {
		            method: 'GET',
		        })
		            .then((response) => {
		                if (response.ok) {
		                    location.reload(); // Reload the page after deleting the message
		                } else {
		                    alert('Failed to delete the message.');
		                }
		            })
		            .catch((error) => console.error('Error:', error));
		    }
		}

    </script>
	<script th:inline="javascript">
		var role=/*[[${role}]]*/''

			$(document).ready(function(){
				debugger
				if(role=='supervisor'){
						let allInputs=$(".btn-edit,.btn-delete,.btn-add-msg")
						for(let i=0;i<allInputs.length;i++){
								allInputs[i].disabled=true
						}
					}
			})
	   </script>
</body>
</html>

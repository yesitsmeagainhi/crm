<!-- fragments/sidebar.html -->
<th:block xmlns:th="http://www.thymeleaf.org">

  <!-- Logout popup -->
  <div class="cd-popup" role="alert">
    <div class="cd-popup-container text-dark">
      <p id="logout-popup-title">Are you sure you want to logout?</p>
      <ul class="cd-buttons ps-0">
        <li><a class="logout-btn cd-popup-close2">Yes</a></li>
        <li><a class="cd-popup-close2">No</a></li>
      </ul>
      <a href="#0" class="cd-popup-close img-replace">Close</a>
    </div>
  </div>

  <aside class="sidenav navbar navbar-vertical navbar-expand-xs border-0 border-radius-xl my-3 fixed-start ms-3 bg-gradient-white bg-white"
         id="sidenav-main">

    <div class="sidenav-header1 text-center">
      <i class="fas fa-times p-3 cursor-pointer text-dark opacity-5 position-absolute end-0 top-0 d-none d-xl-none"
         aria-hidden="true" id="iconSidenav"></i>

      <img src="/img/logos/crmb-logo.jpg" alt="main_logo"
           style="width: 100px;height: 90px;text-align: center;">
      <a class="navbar-brand m-0 text-center pb-0 pt-0"></a>
    </div>

    <hr class="horizontal light mt-0 mb-2">

    <div class="collapse navbar-collapse w-auto" id="sidenav-collapse-main">

      <ul class="navbar-nav"
          th:with="
            acc=${access != null ? access : session.access},
            roleVal=${role != null ? role : session.role},
            roleLower=${roleVal != null ? #strings.toLowerCase(#strings.trim(roleVal)) : ''},
            isAdmin=${roleLower == 'admin'},
            accNotEmpty=${acc != null and !#lists.isEmpty(acc)},

            dashAccess=${accNotEmpty and !#lists.isEmpty(acc.?[
              (#strings.toUpperCase(#strings.trim(modules.name)) == 'DASHBOARD') or
              (#strings.toUpperCase(#strings.trim(modules.name)) == 'DASHBORAD')
            ]) ? acc.?[
              (#strings.toUpperCase(#strings.trim(modules.name)) == 'DASHBOARD') or
              (#strings.toUpperCase(#strings.trim(modules.name)) == 'DASHBORAD')
            ][0] : null},

            automationAccess=${accNotEmpty and !#lists.isEmpty(acc.?[
              #strings.toUpperCase(#strings.trim(modules.name)) == 'AUTOMATION'
            ]) ? acc.?[
              #strings.toUpperCase(#strings.trim(modules.name)) == 'AUTOMATION'
            ][0] : null},

            adMgmtAccess=${accNotEmpty and !#lists.isEmpty(acc.?[
              (#strings.toUpperCase(#strings.trim(modules.name)) == 'AD MANAGEMENT') or
              (#strings.toUpperCase(#strings.trim(modules.name)) == 'AD MANGEMENT')
            ]) ? acc.?[
              (#strings.toUpperCase(#strings.trim(modules.name)) == 'AD MANAGEMENT') or
              (#strings.toUpperCase(#strings.trim(modules.name)) == 'AD MANGEMENT')
            ][0] : null},

            mailConfigAccess=${accNotEmpty and !#lists.isEmpty(acc.?[
              #strings.toUpperCase(#strings.trim(modules.name)) == 'MAIL CONFIGURATION'
            ]) ? acc.?[
              #strings.toUpperCase(#strings.trim(modules.name)) == 'MAIL CONFIGURATION'
            ][0] : null},

            leadsSummaryAccess=${accNotEmpty and !#lists.isEmpty(acc.?[
              #strings.toUpperCase(#strings.trim(modules.name)) == 'LEAD SUMMARY'
            ]) ? acc.?[
              #strings.toUpperCase(#strings.trim(modules.name)) == 'LEAD SUMMARY'
            ][0] : null},

            leadsTransferAccess=${accNotEmpty and !#lists.isEmpty(acc.?[
              #strings.toUpperCase(#strings.trim(modules.name)) == 'LEAD TRANSFER'
            ]) ? acc.?[
              #strings.toUpperCase(#strings.trim(modules.name)) == 'LEAD TRANSFER'
            ][0] : null},

            messageMasterAccess=${accNotEmpty and !#lists.isEmpty(acc.?[
              #strings.toUpperCase(#strings.trim(modules.name)) == 'MESSAGE MASTER'
            ]) ? acc.?[
              #strings.toUpperCase(#strings.trim(modules.name)) == 'MESSAGE MASTER'
            ][0] : null},

            sourceMasterAccess=${accNotEmpty and !#lists.isEmpty(acc.?[
              #strings.toUpperCase(#strings.trim(modules.name)) == 'SOURCE MASTER'
            ]) ? acc.?[
              #strings.toUpperCase(#strings.trim(modules.name)) == 'SOURCE MASTER'
            ][0] : null},

            courseMasterAccess=${accNotEmpty and !#lists.isEmpty(acc.?[
              #strings.toUpperCase(#strings.trim(modules.name)) == 'COURSE MASTER'
            ]) ? acc.?[
              #strings.toUpperCase(#strings.trim(modules.name)) == 'COURSE MASTER'
            ][0] : null},

            commentMasterAccess=${accNotEmpty and !#lists.isEmpty(acc.?[
              #strings.toUpperCase(#strings.trim(modules.name)) == 'COMMENT MASTER'
            ]) ? acc.?[
              #strings.toUpperCase(#strings.trim(modules.name)) == 'COMMENT MASTER'
            ][0] : null},

            accessMgmtAccess=${accNotEmpty and !#lists.isEmpty(acc.?[
              #strings.toUpperCase(#strings.trim(modules.name)) == 'ACCESS MANAGEMENT'
            ]) ? acc.?[
              #strings.toUpperCase(#strings.trim(modules.name)) == 'ACCESS MANAGEMENT'
            ][0] : null},

            addTaskAccess=${accNotEmpty and !#lists.isEmpty(acc.?[
              #strings.toUpperCase(#strings.trim(modules.name)) == 'ADD TASK'
            ]) ? acc.?[
              #strings.toUpperCase(#strings.trim(modules.name)) == 'ADD TASK'
            ][0] : null},

            showDashboard=${isAdmin or (dashAccess != null and (dashAccess.isEdit == true or dashAccess.isView == true))},
            showAutomation=${isAdmin or (automationAccess != null and (automationAccess.isEdit == true or automationAccess.isView == true))},
            showAdMgmt=${isAdmin or (adMgmtAccess != null and (adMgmtAccess.isEdit == true or adMgmtAccess.isView == true))},
            showMailConfig=${isAdmin or (mailConfigAccess != null and (mailConfigAccess.isEdit == true or mailConfigAccess.isView == true))},
            showLeadsSummary=${isAdmin or (leadsSummaryAccess != null and (leadsSummaryAccess.isEdit == true or leadsSummaryAccess.isView == true))},
            showLeadsTransfer=${isAdmin or (leadsTransferAccess != null and (leadsTransferAccess.isEdit == true or leadsTransferAccess.isView == true))},
            showMessageMaster=${isAdmin or (messageMasterAccess != null and (messageMasterAccess.isEdit == true or messageMasterAccess.isView == true))},
            showCourseMaster=${isAdmin or (courseMasterAccess != null and (courseMasterAccess.isEdit == true or courseMasterAccess.isView == true))},
            showSourceMaster=${isAdmin or (sourceMasterAccess != null and (sourceMasterAccess.isEdit == true or sourceMasterAccess.isView == true))},
            showCommentMaster=${roleLower != 'supervisor' and (isAdmin or (commentMasterAccess != null and (commentMasterAccess.isEdit == true or commentMasterAccess.isView == true)))},
            showAccessMgmt=${roleLower != 'supervisor' and (isAdmin or (accessMgmtAccess != null and (accessMgmtAccess.isEdit == true or accessMgmtAccess.isView == true)))},
            showAddTask=${roleLower != 'supervisor' and (isAdmin or (addTaskAccess != null and (addTaskAccess.isEdit == true or addTaskAccess.isView == true)))}
          ">

        <!-- Profile section -->
        <li class="nav-item text-center mb-4">
          <div class="avatar avatar-xl position-relative text-dark cd-popup-trigger-profile my-0">
            <span class="material-icons opacity-10 profile-icon" style="font-size: 3rem;">account_circle</span>
            <img src="" class="d-none" id="profilePreview" alt="profile image">
          </div>

          <div class="d-none" th:text="${prefferedUserName}" id="prefferedUserName"></div>
          <div class="d-none" th:text="${isUserActive}" id="isUserActive"></div>

          <div class="mt-0 text-dark" id="userDisplayName" th:text="${userName}">Admin</div>
          <div class="mt-0 text-dark" style="line-height: 0.7;" th:text="${roleVal}">admin</div>

          <label class="switch mt-2">
            <input type="checkbox" class="userActiveCheckBox" autocomplete="off">
            <span class="slider round"></span>
          </label>
        </li>

        <!-- Tasks (Always visible) -->
        <li class="nav-item">
          <a class="nav-link text-dark"
             th:classappend="${task} ? 'active bg-gradient-primary' : ''"
             href="/crmbot/tasks">
            <div class="text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">dashboard</i>
            </div>
            <span class="nav-link-text ms-1">Tasks</span>
          </a>
        </li>

        <!-- Add Task -->
        <li class="nav-item" th:if="${showAddTask}">
          <a class="nav-link text-dark"
             th:classappend="${addtask} ? 'active bg-gradient-primary' : ''"
             href="/crmbot/add-task">
            <div class="text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">add</i>
            </div>
            <span class="nav-link-text ms-1">Add Task</span>
          </a>
        </li>

        <!-- Access Management -->
        <li class="nav-item" th:if="${showAccessMgmt}">
          <a class="nav-link text-dark"
             th:classappend="${accessManagement} ? 'active bg-gradient-primary' : ''"
             href="/admin/accessManagement">
            <div class="text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">admin_panel_settings</i>
            </div>
            <span class="nav-link-text ms-1">Access Management</span>
          </a>
        </li>

        <!-- Comment Master -->
        <li class="nav-item" th:if="${showCommentMaster}">
          <a class="nav-link text-dark"
             th:classappend="${(commentmaster == true) or (commentMaster == true)} ? 'active bg-gradient-primary' : ''"
             href="/admin/commentmaster">
            <div class="text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">comment</i>
            </div>
            <span class="nav-link-text ms-1">Comment Master</span>
          </a>
        </li>

        <!-- Dashboard -->
        <li class="nav-item" th:if="${showDashboard}">
          <a class="nav-link text-dark"
             th:classappend="${dashboard} ? 'active bg-gradient-primary' : ''"
             href="/admin/dashboard">
            <div class="text-dark text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">table_view</i>
            </div>
            <span class="nav-link-text ms-1">Dashboard</span>
          </a>
        </li>

        <!-- Automation -->
        <li class="nav-item" th:if="${showAutomation}">
          <a class="nav-link text-dark"
             th:classappend="${automation} ? 'active bg-gradient-primary' : ''"
             href="/crmbot/automation">
            <div class="text-dark text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">table_view</i>
            </div>
            <span class="nav-link-text ms-1">Automation</span>
          </a>
        </li>

        <!-- Ad Management -->
        <li class="nav-item" th:if="${showAdMgmt}">
          <a class="nav-link text-dark"
             th:classappend="${addManagement} ? 'active bg-gradient-primary' : ''"
             href="/admin/add-management">
            <div class="text-dark text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">add_chart</i>
            </div>
            <span class="nav-link-text ms-1">Ad Management</span>
          </a>
        </li>

        <!-- Mail Configuration -->
        <li class="nav-item" th:if="${showMailConfig}">
          <a class="nav-link text-dark"
             th:classappend="${mailConfiguration} ? 'active bg-gradient-primary' : ''"
             href="/admin/mail-configuration">
            <div class="text-dark text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">add_chart</i>
            </div>
            <span class="nav-link-text ms-1">Mail Configuration</span>
          </a>
        </li>

        <!-- Leads Summary -->
        <li class="nav-item" th:if="${showLeadsSummary}">
          <a class="nav-link text-dark" target="_blank" href="/crmbot/leads-summary">
            <div class="text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">add_chart</i>
            </div>
            <span class="nav-link-text ms-1">Leads Summary</span>
          </a>
        </li>

        <!-- Leads Transfer -->
        <li class="nav-item" th:if="${showLeadsTransfer}">
          <a class="nav-link text-dark"
             th:classappend="${leadsTransfer} ? 'active bg-gradient-primary' : ''"
             href="/crmbot/leads-transfer">
            <div class="text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">add_chart</i>
            </div>
            <span class="nav-link-text ms-1">Leads Transfer</span>
          </a>
        </li>

        <!-- Message Master -->
        <li class="nav-item" th:if="${showMessageMaster}">
          <a class="nav-link text-dark"
             th:classappend="${messageMaster} ? 'active bg-gradient-primary' : ''"
             href="/messages">
            <div class="text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">add_chart</i>
            </div>
            <span class="nav-link-text ms-1">Message Master</span>
          </a>
        </li>

        <!-- Course Master -->
        <li class="nav-item" th:if="${showCourseMaster}">
          <a class="nav-link text-dark"
             th:classappend="${courseMaster} ? 'active bg-gradient-primary' : ''"
             href="/admin/coursemaster">
            <div class="text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">add_chart</i>
            </div>
            <span class="nav-link-text ms-1">Course Master</span>
          </a>
        </li>

        <!-- Source Master -->
        <li class="nav-item" th:if="${showSourceMaster}">
          <a class="nav-link text-dark"
             th:classappend="${sourceMaster} ? 'active bg-gradient-primary' : ''"
             href="/admin/sourcemaster">
            <div class="text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">add_chart</i>
            </div>
            <span class="nav-link-text ms-1">Source Master</span>
          </a>
        </li>

        <!-- Account pages -->
        <li class="nav-item mt-3">
          <h6 class="ps-4 ms-2 text-uppercase text-xs text-dark font-weight-bolder opacity-8">Account pages</h6>
        </li>

        <li class="nav-item">
          <a class="nav-link text-dark">
            <div class="text-dark text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">person</i>
            </div>
            <span class="nav-link-text ms-1">Profile</span>
          </a>
        </li>

        <li class="nav-item">
          <a class="nav-link text-dark cd-popup-trigger">
            <div class="text-dark text-center me-2 d-flex align-items-center justify-content-center">
              <i class="material-icons opacity-10">logout</i>
            </div>
            <span class="nav-link-text ms-1">Sign Out</span>
          </a>
        </li>

      </ul>
    </div>

    <!-- Profile popup -->
    <div class="cd-popup-profile" role="alert">
      <div class="d-flex" style="max-width: 200px; margin: auto; margin-top: 6em;">
        <span id="modal-profile-image-wrapper">
          <img src="" id="modal-profile-image" width="200" style="border-radius: 50%">
          <button class="remove-profile-btn">
            <span class="material-icons opacity-10 delete-icon" style="font-size: 1rem;">delete</span>
          </button>
          <button class="edit-profile-btn">
            <span class="material-icons opacity-10 edit-icon" style="font-size: 1rem;">edit</span>
          </button>
        </span>
      </div>

      <div class="cd-popup-container2 text-dark mt-2 d-none" id="profile-popup" style="min-width: 200px;">
        <div class="card-header text-lg py-2"
             style="background: #e3e3e3;border-radius: 5px 5px 0px 0px;">Upload File</div>

        <form id="excel-form">
          <p id="profile-upload-input-p">
            <input id="profile-upload-input" type="file" autocomplete="off">
          </p>
          <ul class="cd-buttons2 ps-0" id="cd-main-buttons">
            <li><a class="cd-popup-close-profile">Cancel</a></li>
            <li><a class="profile-upload">Submit</a></li>
          </ul>
        </form>
      </div>
    </div>

  </aside>

</th:block>

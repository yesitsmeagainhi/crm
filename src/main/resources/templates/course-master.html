<th:block layout:replace="fragments/htmlhead"></th:block>

<body class="g-sidenav-show  bg-gray-200">
  <th:block layout:replace="fragments/sidebar"></th:block>	
  <main class="main-content position-relative max-height-vh-100 h-100 border-radius-lg ">
    <!-- Navbar -->
    <th:block layout:replace="fragments/header"></th:block>
    <!-- End Navbar -->
	<th:block th:if="${access != null and !#lists.isEmpty(access)}"
	      th:with="
	        courseMasterAccess=${#lists.isEmpty(access.?[modules.name == 'COURSE MASTER']) ? null : access.?[modules.name == 'COURSE MASTER'][0]}
	      ">
    <div class="container-fluid pb-4 task-main-container">
		<div class="row">
			<h4 class="col-md-3 col-sm-12 ml-5" style="float: left;margin-bottom: 0px;margin-top: 0.7rem;">Course Master</h4>
		</div>
		<div class="row d-flex justify-content-end">
	  		<div class="col-3 col-md-1">
	  			<button th:if="${courseMasterAccess != null and (courseMasterAccess.isEdit == true)}" class="btn btn-primary cd-popup-trigger2 mt-0 ms-auto"><i  class="material-icons opacity-10 me-2" >add</i></button>
	  		</div>
	  	</div>
      <div class="row" id="">
        <div class="col-12 "  id="add-management-table-container">
          <div class="card mb-4" id="">
            <div class="card-body px-0 pb-2">
              <div class="table-responsive  p-0">
              	<table class="table align-items-center mb-0">
                  <thead>
                    <tr>
                      <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-3">Sr No.</th>
                      <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">Course Name</th>
                
                      <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7" th:if="${courseMasterAccess != null and (courseMasterAccess.isEdit == true)}">Action</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr th:each="course,iStat:${courses}"  th:attr="data-id=${course.id}">
                      <td class="ps-3">
						<span th:text="${iStat.index+1}"></span>
					  </td>
                      <td>
						<span th:text="${course.courseName}" class="name-display"></span>
						<input type="text" class="name-input form-control" th:value="${course.courseName}" style="display: none;">
                      </td>
					  <td  th:if="${courseMasterAccess != null and (courseMasterAccess.isEdit == true)}">
                          <button class="btn btn-sm bg-gradient-primary btn-edit" onclick="editMessage(this)">Edit</button>
                          <button class="btn btn-sm bg-gradient-primary btn-save" onclick="saveMessage(this)" style="display: none;">Save</button>
                          <button class="btn btn-sm btn-danger btn-cancel" onclick="cancelEdit(this)" style="display: none;">Cancel</button>
                          <button class="btn btn-sm btn-danger btn-delete" th:onclick="'deleteMessage(' + ${course.id} + ')'">Delete</button>
                      </td>
                      
                    </tr>
                    
                    
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
   <div class="cd-popup2 " role="alert">
	<div class="cd-popup-container2 assign-popup text-dark" style="min-width: 300px;">
	<div class="card-header text-lg py-2" id="configPopupHeader" style="background: #e3e3e3;border-radius: 5px 5px 0px 0px;">Add Course</div>
		<form role="form"  class="mt-3 d-flex flex-column align-items-center justify-content-center">
	
			<div class="input-group input-group-outline mb-3 w-80 is-filled">
				<label class="form-label">Course Name</label>
				<input type="text"  class="p-2 form-control " id="courseName" autocomplete="off">
			</div>
		
		</form>
		
		
		
		
		<ul class="cd-buttons2 ps-0">
			<li><a  class="cd-popup-close2_2">Cancel</a></li>
			<li><a  class="add-course cursor-pointer" onclick="addMessage()">Add</a></li>
		</ul>
		<a href="#0" class="cd-popup-close_2 img-replace">Close</a>
	</div> <!-- cd-popup-container -->
	
</div>
  <!--   Core JS Files   -->
  <script src="/js/core/popper.min.js"></script>
  <script src="/js/core/bootstrap.min.js"></script>
  <script src="/js/perfect-scrollbar.min.js"></script>
  <script src="/js/smooth-scrollbar.min.js"></script>
  <script src="/js/addmanagement.js"></script>
  <script src="/js/custom-sidebar.js"></script>
  <script src="/js/tasks.js"></script>
  <script th:inline="javascript">
    var win = navigator.platform.indexOf('Win') > -1;
    if (win && document.querySelector('#sidenav-scrollbar')) {
      var options = {
        damping: '0.5'
      }
      Scrollbar.init(document.querySelector('#sidenav-scrollbar'), options);
    }
	var role=/*[[${role}]]*/''

	$(document).ready(function(){
		debugger
		if(role=='supervisor'){
				let allInputs=$(".cd-popup-trigger2")
				for(let i=0;i<allInputs.length;i++){
						allInputs[i].disabled=true
				}
			}
	})
	
	
	// Open the Add Message Modal
			function openModal() {
			    const modal = document.getElementById('addMessageModal');
			    modal.style.display = 'flex'; // Show the modal as a flexbox
			}

			// Close the Add Message Modal
			function closeModal() {
			    const modal = document.getElementById('addMessageModal');
			    modal.style.display = 'none'; // Hide the modal
			}

			// Add a new message
			function addMessage() {
			    const courseName = document.getElementById('courseName').value.trim();
			   

			    if (!courseName) {
			        alert('Please enter course name.');
			        return;
			    }

				var course = {}
				course['courseName'] = courseName
			    // Send data to the backend
			    fetch('/course/create', {
			        method: 'POST',
					headers: {
			            'Content-Type': 'application/json',
			        },
			        body: JSON.stringify(course),
			    })
			        .then((response) => {
			            if (response.ok) {
			                location.reload(); // Reload the page after adding the message
			            } else {
			                alert('Failed to add the course.');
			            }
			        })
			        .catch((error) => console.error('Error:', error));
			}

			// Edit an existing message
			function editMessage(button) {
			    const row = button.closest('tr');
			    const nameDisplay = row.querySelector('.name-display');
			    const nameInput = row.querySelector('.name-input');
			    const saveButton = row.querySelector('.btn-save');
			    const cancelButton = row.querySelector('.btn-cancel');

			    nameDisplay.style.display = 'none';
			    nameInput.style.display = 'block';
			    button.style.display = 'none';
			    saveButton.style.display = 'inline-block';
			    cancelButton.style.display = 'inline-block';
			}

			// Save edited message
			function saveMessage(button) {
			    const row = button.closest('tr');
			    const nameDisplay = row.querySelector('.name-display');
			    const nameInput = row.querySelector('.name-input');
			    
			    const editButton = row.querySelector('.btn-edit');
			    const cancelButton = row.querySelector('.btn-cancel');
			    const courseId = row.getAttribute('data-id');

			    const updatedName = nameInput.value.trim();

			    if (!updatedName) {
			        alert('Please fill the course name');
			        return;
			    }
				var course = {}
				course['id']=courseId
				course['courseName'] = updatedName
			    // Send updated data to the backend
			    fetch('/course/'+courseId, {
			        method: 'PUT',
					contentType:'application/json',
			        headers: {
			            'Content-Type': 'application/json',
			        },
			        body: JSON.stringify(course),
			    })
			        .then((response) => {
			            if (response.ok) {
			                nameDisplay.textContent = updatedName;

			                nameDisplay.style.display = 'block';
			                nameInput.style.display = 'none';
			               
			                button.style.display = 'none';
			                cancelButton.style.display = 'none';
			                editButton.style.display = 'inline-block';
							alert('Successfully edited the course');
			            } else {
			                alert('Failed to save the course.');
			            }
			        })
			        .catch((error) => console.error('Error:', error));
			}

			// Cancel editing a message
			function cancelEdit(button) {
			    const row = button.closest('tr');
			    const nameDisplay = row.querySelector('.name-display');
			    const nameInput = row.querySelector('.name-input');
			   
			    const editButton = row.querySelector('.btn-edit');
			    const saveButton = row.querySelector('.btn-save');

			    nameInput.style.display = 'none';
			    nameDisplay.style.display = 'block';
			    button.style.display = 'none';
			    saveButton.style.display = 'none';
			    editButton.style.display = 'inline-block';
			}

			// Delete a message
			function deleteMessage(courseId) {
			    if (confirm('Are you sure you want to delete this course?')) {
			        fetch(`/course/${courseId}`, {
			            method: 'DELETE',
			        })
			            .then((response) => {
			                if (response.ok) {
			                    location.reload(); // Reload the page after deleting the message
			                } else {
			                    alert('Failed to delete the course.');
			                }
			            })
			            .catch((error) => console.error('Error:', error));
			    }
			}
  </script>
  <!-- Github buttons -->
  <script async defer src="https://buttons.github.io/buttons.js"></script>
  <!-- Control Center for Material Dashboard: parallax effects, scripts for the example pages etc -->
  <script src="/js/material-dashboard.min.js?v=3.0.4"></script>
</body>
</html>
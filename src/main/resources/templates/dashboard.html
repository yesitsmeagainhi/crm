<th:block layout:replace="fragments/htmlhead"></th:block>
<link href="/css/dashboad.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" rel="stylesheet">
<style>
#toDate,
#fromDate {
	border-radius: 5px 5px;
	padding: 8px;
}

.text-black {
	color: black;
}
.tab-content.hidden {
	 display: none; 
 }
</style>

<body class="g-sidenav-show  bg-gray-200">
	<th:block layout:replace="fragments/sidebar"></th:block>
	<main class="main-content position-relative max-height-vh-100 h-100 border-radius-lg ">
		<!-- Navbar -->
		<th:block layout:replace="fragments/header"></th:block>
		<!-- End Navbar -->
		<div class="container-fluid py-4">
			<div class="row mb-4">
				<div class="col-xl-3 col-sm-5  mb-4 ">
					<select class="role-select w-100" autocomplete="off">
						<option value="" id="0">Select Role</option>
						<option th:each="nextRole:${nextRoles}" th:value="${nextRole}" th:text="${nextRole} ">
						</option>
					</select>
				</div>
				<div class="col-xl-3 col-sm-5  mb-4  user-select-label">
					<select th:each="nextUser,istat:${nextUsers}" class="user-select w-100 " th:classappend="${nextRoles[istat.index]!='telecaller'?'d-none':''}" th:id="${nextRoles[istat.index]}" autocomplete="off">
						<option value="" id="0">Select User</option>
						<option th:each="user:${nextUser}" th:value="${user.get('username')}" th:id="${#strings.arraySplit(user.get('username'),'@')[0]}" th:name="|${user.get('firstName')} ${user.get('lastName')}|" 
										class="status-dot" th:classappend="${user['isActiveOnCRM'] != null and user['isActiveOnCRM']} ? ' active' : ' inactive'"
										th:text="|${user.get('firstName')} ${user.get('lastName')} (${user['isActiveOnCRM'] != null and user['isActiveOnCRM'] ? 'Active' : 'Inactive'})|">
			</select>
        </div>
        <div class="col-xl-3 col-sm-5  mb-4  owner-select-label" >
        	<select  class="owner-select w-100 "  autocomplete="off">
				<option value="" id="0">Is Owner</option>
				<option value="Yes" id="0">Yes</option>
				<option value="No" id="0">No</option>
			</select>
        </div>
        <div class="col-xl-3 col-sm-5  mb-4 ">
        	<select class="w-100" id="platform" autocomplete="off">
	        	<option value="">select platform
	        	</option>
	        	<option th:each="platform:${platforms}"  th:value="${platform.name}" th:text="${platform.name}">Manager
	        	</option>
	        	
        	</select>
        </div>
        <div class="col-xl-3 col-sm-5 mb-4 ">
        	<select class="w-100" id="course" autocomplete="off">
	        	<option value="">select course
	        	</option>
	        	<option th:each="course:${courses}"  th:value="${course.courseName}" th:text="${course.courseName}">Manager
	        	</option>
	        	
        	</select>
        </div>
         <div class="col-xl-3 col-sm-5 mb-4 mt-1">
        	<select class="w-100" id="status" autocomplete="off">
	        	<option value="">select status
	        	</option>
	        	<option value="open">Open
	        	</option>
	        	<option value="processed">Processed
	        	</option>
	        	<option value="completed">Admission Done
	        	</option>
	        	<option value="closed">Task Closed
	        	</option>
        	</select>
        	
        </div>
         <div class="col-xl-3 col-sm-5 mb-4 mt-1">
        	<select class="w-100" id="scheduleStatus" autocomplete="off">
	        	<option value="">select schedule status
	        	</option>
	        	<option value="scheduled">Scheduled
	        	</option>
	        	<option value="not scheduled">Not Scheduled
	        	</option>
        	</select>
         </div>
          <div class="col-xl-3 col-sm-5 mb-4 mt-1">
        	<select class="w-100" id="counsellingStatus" autocomplete="off">
	        	<option value="">select counselling status
	        	</option>
	        	<option value="counselled">Counselled
	        	</option>
	        	<option value="not counselled">Not Counselled
	        	</option>
        	</select>
        	
         </div>
          <div class="col-xl-3 col-sm-5 mb-4 mt-1">
        	<select class="w-100" id="leadType" autocomplete="off">
	        	<option value="">select Lead Type
	        	</option>
				<option value="BLANK">Blank
					        	</option>
	        	<option value="PROSPECT">Prospect
	        	</option>
	        	<option value="HOT">Hot
	        	</option>
	        	<option value="COLD">Cold
	        	</option>
        	</select>
        	
         </div>
		 <div class="col-xl-3 col-sm-5 mb-4 mt-1">
		         	<select class="w-100" id="dateType" autocomplete="off">
						<option value="">Select Date Type
								 					        	</option>
		 				<option value="admissionDate">Admission Date
		 					        	</option>
		 	        	<option value="cousellingDate">Couselling Date
		 	        	</option>
		 	        	
		         	</select>
		         	
		          </div>
         <div class="col-xl-3 col-sm-5 mb-4 mt-1 d-flex">
         <label class="w-20 mt-2 text-left" style="text-align: left;">From Date :</label>
			<input type="date" id="fromDate" class="mb-3 w-80 px-2 " autocomplete="off" style="border: 1px solid #c0c6cc;">
         </div>
          <div class="col-xl-3 col-sm-5 mb-4  d-flex">
          	<label class="w-20 mt-2 text-left" style="text-align: left;">To Date :</label>
			<input type="date" id="toDate" class="mb-3 w-80 px-2 " autocomplete="off"  style="border: 1px solid #c0c6cc;">
			
          </div>
		  <div class="col-xl-2 col-sm-5 mb-4 mt-3 text-center">
          	<input type="checkbox" id="seatConfirmed" name="seatConfirmed"> <span class="text-black">Seat Confirmed</span>
          	
           </div>
          <div class="col-xl-2 col-sm-5 mb-4  d-flex">
         	 <button class="btn btn-primary dashboard-sumbit mt-0 col-12 row">Sumbit</button>
          </div>
            <div class="col-xl-2 col-sm-5 mb-4  d-flex">
         	 <button class="btn btn-primary graph_report col-12 row">download
          </div>
    </div>
      <div class="row">
        
       
        <div class="col mb-xl-0 mb-4">
          <div class="card">
            <div class="card-header p-3 pt-2">
              <div class="icon icon-lg icon-shape bg-gradient-white shadow-primary text-center border-radius-xl mt-n4 position-absolute">
                <img src="/img/logos/present.png" class="position-absolute dash-logo-img" style="top:10%;left:13%" width="35" />
              </div>
              <div class="text-end pt-1">
              	<p class="text-sm mb-0 text-capitalize">Todays Leads</p>
                <h4 class="mb-0" id="todaysLead" th:text="${totalTodaysTask}">103,430</h4>
              </div>
            </div>
            <hr class="dark horizontal my-0">
            <div class="card-footer p-3">
             <!--  <p class="mb-0"><span class="text-success text-sm font-weight-bolder">+3% </span>than last month</p>-->
            </div>
          </div>
        </div>
        <div class="col  mb-xl-0 mb-4">
          <div class="card">
            <div class="card-header p-3 pt-2">
              <div class="icon icon-lg icon-shape bg-gradient-white shadow-success text-center border-radius-xl mt-n4 position-absolute" >
                <img src="/img/logos/processing.png" class="position-absolute dash-logo-img" style="top:8%;left:12%" width="35" />
              </div>
              <div class="text-end pt-1">
              <p class="text-sm mb-0 text-capitalize">Today's counselling</p>
                <h4 class="mb-0"  id="todaysCounselled"></h4>
              </div>
            </div>
            <hr class="dark horizontal my-0">
            <div class="card-footer p-3">
             <!--  <p class="mb-0"><span class="text-danger text-sm font-weight-bolder">-2%</span> than yesterday</p>-->
            </div>
          </div>
        </div>
		<div class="col  mb-xl-0 mb-4">
          <div class="card">
            <div class="card-header p-3 pt-2">
              <div class="icon icon-lg icon-shape bg-gradient-white shadow-success text-center border-radius-xl mt-n4 position-absolute" >
                <img src="/img/logos/processing.png" class="position-absolute dash-logo-img" style="top:8%;left:12%" width="35" />
              </div>
              <div class="text-end pt-1">
              <p class="text-sm mb-0 text-capitalize">Today's seat confirmed</p>
                <h4 class="mb-0" id="todaysSeatConfirmed"></h4>
              </div>
            </div>
            <hr class="dark horizontal my-0">
            <div class="card-footer p-3">
             <!--  <p class="mb-0"><span class="text-danger text-sm font-weight-bolder">-2%</span> than yesterday</p>-->
            </div>
          </div>
        </div>
        <div class="col ">
          <div class="card">
            <div class="card-header p-3 pt-2">
              <div class="icon icon-lg icon-shape bg-gradient-white shadow-info text-center border-radius-xl mt-n4 position-absolute">
                <img src="/img/logos/checked.png" class="position-absolute dash-logo-img" style="top:13%;left:16%" width="30" />
              </div>
              <div class="text-end pt-1">
                <p class="text-sm mb-0 text-capitalize">Total Admission</p>
                <h4 class="mb-0" id="totalAdmission" th:text="${totalConvertedTask}">3,462</h4>
              </div>
            </div>
          <hr class="dark horizontal my-0">
            <div class="card-footer p-3">
              <!--  <p class="mb-0"><span class="text-success text-sm font-weight-bolder">+5% </span>than yesterday</p>
            </div>-->
          </div>
        </div>
      </div>
	  <div class="col  mb-xl-0 mb-4">
            <div class="card">
              <div class="card-header p-3 pt-2">
                <div class="icon icon-lg icon-shape bg-gradient-white shadow-dark text-center border-radius-xl mt-n4 position-absolute">
                  <img src="/img/logos/all.png" class="position-absolute dash-logo-img" width="30" />
                </div>
                <div class="text-end pt-1">
                  <p class="text-sm mb-0 text-capitalize">Total Leads</p>
                  <h4 class="mb-0" id="totalLeads" th:text="${totalTask}">5,300</h4>
                </div>
              </div>
              <hr class="dark horizontal my-0">
              <div class="card-footer p-3">
                <!-- <p class="mb-0"><span class="text-success text-sm font-weight-bolder">+55% </span>than last week</p>-->
              </div>
            </div>
          </div>
       
              </div>
			  
			  <div class="mt-4">
				<button class="btn btn-outline-primary me-2 mb-3 tab-button active"  onclick="openTab('basic')">Basic</button>
				  <button class="btn btn-outline-primary me-2 mb-3 tab-button" onclick="openTab('scrutiny')">Scrutiny</button>

				  <!-- filters -->
				  <div class="row g-3 align-items-center mb-3">
				    <div class="col-auto">
				      <div class="btn-group" id="quickDates">
				        <button class="btn btn-outline-primary date-short-filter" data-range="today">Today</button>
				        <button class="btn btn-outline-primary date-short-filter" data-range="week">Week</button>
				        <button class="btn btn-outline-primary date-short-filter" data-range="month">Month</button>
				        <button class="btn btn-outline-primary date-short-filter active" data-range="all">All</button>
				      </div>
				    </div>
				    <!--<div class="col-auto"><input id="fromDate" class="form-control date-picker" placeholder="From"></div>
				    <div class="col-auto"><input id="toDate"   class="form-control date-picker" placeholder="To"></div>-->

				    <!-- <div class="col-auto">
				      <div class="form-check form-switch">
				        <input class="form-check-input" type="checkbox" id="excludeVikas">
				        <label class="form-check-label" for="excludeVikas">Hide Manager Vikas</label>
				      </div>
				    </div>

				 
				    <div class="col-auto dropdown">
				      <button class="btn btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown" id="entityBtn">Select Callers</button>
				      <div class="dropdown-menu p-3" id="entityList" style="max-height:300px;overflow:auto"></div>
				    </div>-->

				   <!-- <div class="col-auto"><button class="btn btn-primary" id="copyBtn" disabled>Copy Selected</button></div> 
				    <div class="col-auto"><button class="btn btn-success" id="downloadBtn">Download Excel</button></div>-->
				  </div>

				  <!-- table -->
				  <div id="basic" class="tab-content">
					  <div class="card shadow-sm">
					    <div class="card-body table-responsive">
					      <table class="table align-middle mb-0" id="perfTable">
					        <thead class="table-light">
					          <tr>
								<th >Sr.no</th>
					            <th data-k="userName" class="dashboardBasicParam"><span >Entity Name</span><span class="sort-arrow">▲</span><small class="d-block">Caller / Counsellor</small></th>
					            <th data-k="todaysScheduled" class="dashboardBasicParam"><span>Today</span><span class="sort-arrow">▲</span><small>Schedules today</small></th>
					            <th data-k="missedSchedule" class="dashboardBasicParam"><span>Missed</span><span class="sort-arrow">▲</span><small>Schedules before today</small></th>
					            <th data-k="counselled" class="dashboardBasicParam"><span>Couns.</span><span class="sort-arrow">▲</span><small>Leads ≥1 counselling</small></th>
					            <th data-k="converted" class="dashboardBasicParam"><span>Adm.</span><span class="sort-arrow">▲</span><small>Admissions done</small></th>
					          </tr>
					        </thead>
					        <tbody id="perfBody">
								<tr><td colspan="5" class="py-4 text-center">Loading…</td></tr></tbody>
					      </table>
					    </div>
					  </div>
				</div>
				<div id="scrutiny" class="tab-content hidden">
					<div class="card shadow-sm">
					    <div class="card-body table-responsive">
					      <table class="table align-middle mb-0" id="perfTable">
					        <thead class="table-light">
							  <tr>
								<th >Sr.no</th>
								<th data-k="name" class="dashboardScrutinyParam px-0"><span>Entity</span><span class="sort-arrow">▲</span><small>name</small></th>
					            <th data-k="total"  class="dashboardScrutinyParam px-0"><span>Total</span><span class="sort-arrow">▲</span><small>All task</small></th>
								<th data-k="dustbin"  class="dashboardScrutinyParam px-0"><span>Dustbin</span><span class="sort-arrow">▲</span><small>Moved to dustbin</small></th>
								<th data-k="blank"  class="dashboardScrutinyParam px-0"><span>Blank</span><span class="sort-arrow">▲</span><small>Lead type=BLANK</small></th>
					            <th data-k="hot" class="dashboardScrutinyParam px-0" ><span>Hot</span><span class="sort-arrow">▲</span><small>Lead type=HOT</small></th>
					            <th data-k="prospect" class="dashboardScrutinyParam px-0"><span>Prospect</span><span class="sort-arrow">▲</span><small>Lead type=PROSPECT</small></th>
					            <th data-k="cold" class="dashboardScrutinyParam px-0"><span>Cold</span><span class="sort-arrow">▲</span><small>Lead type=COLD</small></th>
								<th data-k="nocomment" class="dashboardScrutinyParam px-0"><span>No Comm.</span><span class="sort-arrow">▲</span><small>No comment</small></th>
								<th data-k="noschedule" class="dashboardScrutinyParam px-0"><span>No Sch.</span><span class="sort-arrow">▲</span><small>No scheduler</small></th>
								<th data-k="counselled" class="dashboardBasicParam px-0"><span>Couns.</span><span class="sort-arrow">▲</span><small>Leads ≥1 counselling</small></th>
					            <th data-k="converted" class="dashboardBasicParam px-0"><span>Adm.</span><span class="sort-arrow">▲</span><small>Admissions done</small></th>
					            <!--<th data-k="blank"><span>Blank</span><span class="sort-arrow">▲</span></th>
					            <th data-k="couns"><span>Couns.</span><span class="sort-arrow">▲</span></th>
					            <th data-k="adm"  ><span>Adm.</span><span class="sort-arrow">▲</span></th>
					            <th data-k="cRate"><span>Couns.%</span><span class="sort-arrow">▲</span></th>
					            <th data-k="aRate"><span>Adm.%</span><span class="sort-arrow">▲</span></th>-->
					          </tr>
					        </thead>
					        <tbody id="perfBodyScrutiny">
								<tr><td colspan="10" class="py-4 text-center">Loading…</td></tr></tbody>
					      </table>
					    </div>
					  </div>
				  </div>
			  </div>
			  
            </div>
          </div>
        </div>
        
      </div>
  </main>

   <script src="/js/core/popper.min.js"></script>
  <script src="/js/core/bootstrap.min.js"></script>
  <script src="/js/perfect-scrollbar.min.js"></script>
  <script src="/js/smooth-scrollbar.min.js"></script>
  <script src="/js/custom-sidebar.js"></script>
   <script src="/js/add-task.js"></script>
  <script>
	
	$(document).ready(function() {
		applyFilter()
		populateCardData(true)
	});
	
	
	function setProfileImages(userName,index){
			debugger
			var request={
			}
			request['userName']=userName
			$.ajax({
				url:'/usermaster/get',
				type:'POST',
				data: JSON.stringify(request),
				contentType : 'application/json',
				success:function(data){
					if(data){
						if (data.image) {
						    const img = document.getElementById('profilePic'+index);
						    img.src = `data:image/jpeg;base64,${data.image}`;
						    img.style.display = 'block';
							$(".profile-icon").addClass("d-none")
						}
					}
				},
				error:function(err){
					console.log(err)
				}
				
			})
		}
	
	function openTab(tabName) {
	    document.querySelectorAll('.tab-button').forEach(button => button.classList.remove('active'));
	    document.querySelectorAll('.tab-content').forEach(content => content.classList.add('hidden'));

	    document.querySelector(`.tab-button[onclick="openTab('${tabName}')"]`).classList.add('active');
	    document.getElementById(tabName).classList.remove('hidden');
	  }
	  
    var win = navigator.platform.indexOf('Win') > -1;
    if (win && document.querySelector('#sidenav-scrollbar')) {
      var options = {
        damping: '0.5'
      }
      Scrollbar.init(document.querySelector('#sidenav-scrollbar'), options);
    }
    

  	var iAsc = false
	var paramter = 'userName'
	var dateRange = 'all'
	
	var iAscScrutiny = false
	var paramterScrutiny = 'userName'
	$('body').on('click','.date-short-filter',function(e){
			var currentRangeClicked =  $(this)
			dateRange = currentRangeClicked.attr('data-range')
			$(" .date-short-filter").removeClass("active")
			currentRangeClicked.addClass("active")
		})
		
	$('body').on('click','.dashboardBasicParam',function(e){
		$("#perfBody").html('<tr><td colspan="5" class="py-4 text-center">Loading…</td></tr></tbody>')
				
		const currentParam = $(this).attr('data-k')
		if(currentParam == paramter){
			iAsc =! iAsc
		}else{
			paramter = currentParam
			iAsc = true
		}
		if(dateRange=='all'){
			filterRequests['fromDate']=$("#fromDate").val()
			filterRequests['toDate']=$("#toDate").val()
		}else if(dateRange=='month'){
			filterRequests=setMonthRange(filterRequests)
		}else if(dateRange=='week'){
			filterRequests=setWeekRange(filterRequests)
		}else if(dateRange=='today'){
			// Get today's date
			const today = new Date();

			// Format the date as YYYY-MM-DD
			const formattedToday = today.toISOString().split('T')[0];
			filterRequests['fromDate']=formattedToday
			filterRequests['toDate']=formattedToday
		}
		$.ajax({
			url:"/admin/graphs/get?paramter="+paramter+"&isAsc="+iAsc,
			type:"PUT",
			data:JSON.stringify(filterRequests),
			contentType:"application/json",
			success:function(data){
				console.log(data)
				debugger;
				$("#perfBody").html(data)
				//setProfileImageForFirstFive()
				/*try{
					showGraphAfterFilter(data['XPlots'],data['YPlots'])
					$("#totalLeads").text(data['totalLeads'])
				}catch(err){
					console.log(err)
				}*/
				
			},
			error:function(err){
				console.log(err)
			}
		})
		
	})
	
	$('body').on('click','.dashboardScrutinyParam',function(e){
		$("#perfBodyScrutiny").html('<tr><td colspan="10" class="py-4 text-center">Loading…</td></tr></tbody>')
			const currentParam = $(this).attr('data-k')
			if(currentParam == paramterScrutiny){
				iAscScrutiny =! iAscScrutiny
			}else{
				paramterScrutiny = currentParam
				iAscScrutiny = true
			}
			if(dateRange=='all'){
				filterRequests['fromDate']=$("#fromDate").val()
				filterRequests['toDate']=$("#toDate").val()
			}else if(dateRange=='month'){
				filterRequests=setMonthRange(filterRequests)
			}else if(dateRange=='week'){
				filterRequests=setWeekRange(filterRequests)
			}else if(dateRange=='today'){
				// Get today's date
				const today = new Date();
	
				// Format the date as YYYY-MM-DD
				const formattedToday = today.toISOString().split('T')[0];
				filterRequests['fromDate']=formattedToday
				filterRequests['toDate']=formattedToday
			}
			$.ajax({
				url:"/admin/graphs/get-scrutiny?paramter="+paramterScrutiny+"&isAsc="+iAscScrutiny,
				type:"PUT",
				data:JSON.stringify(filterRequests),
				contentType:"application/json",
				success:function(data){
					console.log(data)
					debugger;
					$("#perfBodyScrutiny").html(data)
					/*try{
						showGraphAfterFilter(data['XPlots'],data['YPlots'])
						$("#totalLeads").text(data['totalLeads'])
					}catch(err){
						console.log(err)
					}*/
					
				},
				error:function(err){
					console.log(err)
				}
			})
		})
	
	function setMonthRange(filterRequests){
		// Get the current date
		const now = new Date();
	debugger;
		// Get the start of the current month
		const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);

		// Get the end of the current month
		const endOfMonth = new Date(now.getFullYear(), now.getMonth()+1 , 0);
		// Format the dates as YYYY-MM-DD
		const startDate = startOfMonth.getFullYear() + '-' +
		                    String(startOfMonth.getMonth() + 1).padStart(2, '0') + '-' +
		                    String(startOfMonth.getDate()).padStart(2, '0');
		const endDate = endOfMonth.getFullYear() + '-' +
				                    String(endOfMonth.getMonth() + 1).padStart(2, '0') + '-' +
				                    String(endOfMonth.getDate()).padStart(2, '0');
		filterRequests['fromDate']=startDate
		filterRequests['toDate']=endDate
		console.log("Today's date:", startDate);
		return filterRequests;

	}
    function setWeekRange(filterRequests){
		// Get the current date
		const now = new Date();

		// Get the current day of the week (0 = Sunday, 1 = Monday, ..., 6 = Saturday)
		const currentDay = now.getDay();

		// Calculate the start of the week (Monday)
		const startOfWeek = new Date(now);
		startOfWeek.setDate(now.getDate() - ((currentDay === 0 ? 7 : currentDay) - 1));

		// Calculate the end of the week (Sunday)
		const endOfWeek = new Date(startOfWeek);
		endOfWeek.setDate(startOfWeek.getDate() + 6);

		// Format the dates as YYYY-MM-DD
		const startDate = startOfWeek.toISOString().split('T')[0];
		const endDate = endOfWeek.toISOString().split('T')[0];

		filterRequests['fromDate']=startDate
		filterRequests['toDate']=endDate
		return filterRequests;		

	}
	
    $("body").on("click",".dashboard-sumbit",function(e){
		
		applyFilter()
		populateCardData(false)
	})
	
	
	 $("body").on("click",".graph_report",function(e){
		var filterRequests={}
		filterRequests['role']=$(".role-select").val()
		filterRequests['assignee']=$(".role-select").val()
		if($(".role-select").val()!="")
			filterRequests['userName']=$("#"+$(".role-select").val()).val()
		filterRequests['leadPlatform']=$("#platform").val()
		filterRequests['courseName']=$("#course").val()
		filterRequests['status']=$("#status").val()
		filterRequests['isActive']=true
		filterRequests['isOwner']=false
		filterRequests['isScheduled']=$("#scheduleStatus").val()=='scheduled'?true:($("#scheduleStatus").val()=="not scheduled")?false:null
		filterRequests['isCounselled']=$("#counsellingStatus").val()=='counselled'?true:($("#counsellingStatus").val()=="not counselled")?false:null
		filterRequests['fromDate']=$("#fromDate").val()
		filterRequests['toDate']=$("#toDate").val()
		if($("#dateType").val() && $("#dateType").val().length>0){
			filterRequests['isDateTypeChanged']=true
		}else{
			filterRequests['isDateTypeChanged']=false
		}
		const today = new Date();

					// Format the date as YYYY-MM-DD
		const formattedToday = today.toISOString().split('T')[0];
		//filterRequests['toDate']=formattedToday
		filterRequests['leadType']=$("#leadType").val()
		if($('#seatConfirmed').is(':checked')){
			filterRequests['isSeatConfirmed']=true
		}
		
		if($(".owner-select").val()=="Yes"){
			filterRequests['isOwner']=true
		}
		$.ajax({
			url:"/admin/graphreport",
			type:"PUT",
			data:JSON.stringify(filterRequests),
			contentType:"application/json",
			xhrFields: {
	            responseType: 'blob'
	        },
			success:function(data){
				console.log(data)
				try{
					debugger;
					const url = window.URL.createObjectURL(data);
				    const a = document.createElement('a');
				    a.style.display = 'none';
				    a.href = url;
				    // the filename you want
				    a.download = 'graph_report.xlsx';
				    document.body.appendChild(a);
				    a.click();
				    window.URL.revokeObjectURL(url);
				}catch(err){
					console.log(err)
				}
				
			},
			error:function(err){
				console.log(err)
			}
		})
	})
	
	var filterRequests={}
	function applyFilter(){
		debugger
		filterRequests ={}
		$("#perfBody").html('<tr><td colspan="5" class="py-4 text-center">Loading…</td></tr></tbody>')
		$("#perfBodyScrutiny").html('<tr><td colspan="8" class="py-4 text-center">Loading…</td></tr></tbody>')
		
		let selectedRole = $(".role-select").val()
		filterRequests['role']=$(".role-select").val()
		filterRequests['assignee']=$(".role-select").val()
		if($(".role-select").val()!=""){
			filterRequests['userName']=$("#"+$(".role-select").val()).val()
			selectedUser = $("#"+$(".role-select").val()).val()
			var selectedOption2= $("#"+selectedRole+ " option[value='" + selectedUser + "']");
			if (selectedOption2.length > 0) {
		        var selectedOptionName2 = selectedOption2.attr("name");
		    } 
			filterRequests['userNameForUi']=selectedOptionName2
		}
			
		
		filterRequests['leadPlatform']=$("#platform").val()
		filterRequests['courseName']=$("#course").val()
		filterRequests['status']=$("#status").val()
		filterRequests['isActive']=true
		filterRequests['isOwner']=false
		filterRequests['isScheduled']=$("#scheduleStatus").val()=='scheduled'?true:($("#scheduleStatus").val()=="not scheduled")?false:null
		filterRequests['isCounselled']=$("#counsellingStatus").val()=='counselled'?true:($("#counsellingStatus").val()=="not counselled")?false:null
		if(dateRange=='all'){
			filterRequests['fromDate']=$("#fromDate").val()
			filterRequests['toDate']=$("#toDate").val()
		}else if(dateRange=='month'){
			filterRequests=setMonthRange(filterRequests)
		}else if(dateRange=='week'){
			filterRequests=setWeekRange(filterRequests)
		}else if(dateRange=='today'){
			// Get today's date
			const today = new Date();

			// Format the date as YYYY-MM-DD
			const formattedToday = today.toISOString().split('T')[0];
			filterRequests['fromDate']=formattedToday
			filterRequests['toDate']=formattedToday
		}
		
		
		
		filterRequests['leadType']=$("#leadType").val()
		if($("#dateType").val() && $("#dateType").val().length>0){
			filterRequests['isDateTypeChanged']=true
		}else{
			filterRequests['isDateTypeChanged']=false
		}
		if($('#seatConfirmed').is(':checked')){
			filterRequests['isSeatConfirmed']=true
		}
		if($(".owner-select").val()=="Yes"){
			filterRequests['isOwner']=true
		}
		$.ajax({
			url:"/admin/graphs/get?paramter="+paramter+"&isAsc="+iAsc,
			type:"PUT",
			data:JSON.stringify(filterRequests),
			contentType:"application/json",
			success:function(data){
				console.log(data)
				debugger;
				$("#perfBody").html(data)
				
				/*try{
					showGraphAfterFilter(data['XPlots'],data['YPlots'])
					$("#totalLeads").text(data['totalLeads'])
				}catch(err){
					console.log(err)
				}*/
				
			},
			error:function(err){
				console.log(err)
			}
		})
		
		$.ajax({
			url:"/admin/graphs/get-scrutiny?paramter="+paramterScrutiny+"&isAsc="+iAscScrutiny,
			type:"PUT",
			data:JSON.stringify(filterRequests),
			contentType:"application/json",
			success:function(data){
				console.log(data)
				debugger;
				$("#perfBodyScrutiny").html(data)
				/*try{
					showGraphAfterFilter(data['XPlots'],data['YPlots'])
					$("#totalLeads").text(data['totalLeads'])
				}catch(err){
					console.log(err)
				}*/
				
			},
			error:function(err){
				console.log(err)
			}
		})
	}
	
	function populateCardData(isInitialLoad){
		
		
		let selectedRole = $(".role-select").val()
		if(!isInitialLoad){
			filterRequests['role']=$(".role-select").val()
			if($(".role-select").val()!=""){
				filterRequests['userName']=$("#"+$(".role-select").val()).val()
				selectedUser = $("#"+$(".role-select").val()).val()
				var selectedOption2= $("#"+selectedRole+ " option[value='" + selectedUser + "']");
				if (selectedOption2.length > 0) {
			        var selectedOptionName2 = selectedOption2.attr("name");
			    } 
				filterRequests['userNameForUi']=selectedOptionName2
			}
		}
		
		filterRequests['leadPlatform']=$("#platform").val()
		filterRequests['courseName']=$("#course").val()
		filterRequests['isActive']=true
		filterRequests['isOwner']=false
		filterRequests['isScheduled']=$("#scheduleStatus").val()=='scheduled'?true:($("#scheduleStatus").val()=="not scheduled")?false:null
		filterRequests['isCounselled']=$("#counsellingStatus").val()=='counselled'?true:($("#counsellingStatus").val()=="not counselled")?false:null
		
		debugger
		if(dateRange=='all'){
			
			
			if(!($("#fromDate").val() && !$("#toDate").val())){
				const today = new Date();
															
				// Format the date as YYYY-MM-DD
				const formattedToday = today.toISOString().split('T')[0];
				filterRequests['fromDate']=formattedToday
				filterRequests['toDate']=formattedToday
				
			}
			if($("#fromDate").val()){
				filterRequests['fromDate']=$("#fromDate").val()
			}	
			if($("#toDate").val()){
				filterRequests['toDate']=$("#toDate").val()
			}
		}else if(dateRange=='month'){
			filterRequests=setMonthRange(filterRequests)
		}else if(dateRange=='week'){
			filterRequests=setWeekRange(filterRequests)
		}else if(dateRange=='today'){
			// Get today's date
			const today = new Date();
	
			// Format the date as YYYY-MM-DD
			const formattedToday = today.toISOString().split('T')[0];
			filterRequests['fromDate']=formattedToday
			filterRequests['toDate']=formattedToday
		}
		if($("#leadType").val())
			filterRequests['leadType']=$("#leadType").val()
		if($(".owner-select").val()=="Yes"){
			filterRequests['isOwner']=true
		}
		if($("#dateType").val() && $("#dateType").val().length>0){
			filterRequests['isDateTypeChanged']=true
		}else{
			filterRequests['isDateTypeChanged']=false
		}
		$.ajax({
			url:"/admin/graphs/carddata",
			type:"PUT",
			data:JSON.stringify(filterRequests),
			contentType:"application/json",
			success:function(data){
				debugger;
				console.log(data)
				if(data){
					$("#todaysLead").text(data.todaysLeads)
					$("#todaysCounselled").text(data.todaysCounselled)
					$("#todaysSeatConfirmed").text(data.todaysSeatConfirmed)
					$("#totalAdmission").text(data.totalAdmission)
					$("#totalLeads").text(data.totalLeads)
				}
			},
			error:function(err){
				console.log(err)
			}
		})
	}
	
  </script>
  <script src="/js/custom-sidebar.js"></script>
  <!-- Github buttons -->
  <script async defer src="https://buttons.github.io/buttons.js"></script>
  <!-- Control Center for Material Dashboard: parallax effects, scripts for the example pages etc -->
  <script src="/js/material-dashboard.min.js?v=3.0.4"></script>
</body>

</html>